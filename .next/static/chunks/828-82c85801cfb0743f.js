(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[828],{7907:function(e,t,n){"use strict";var r=n(5313);n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}})},4930:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return l}});let r=n(6921);n(3827),n(4090);let a=r._(n(4795));function l(e,t){let n={loading:e=>{let{error:t,isLoading:n,pastDelay:r}=e;return null}};return"function"==typeof e&&(n.loader=e),(0,a.default)({...n,...t})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},9721:function(e,t,n){"use strict";function r(e){let{reason:t,children:n}=e;return n}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return r}}),n(9775)},4795:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o}});let r=n(3827),a=n(4090),l=n(9721);function s(e){var t;return{default:null!=(t=null==e?void 0:e.default)?t:e}}let i={loader:()=>Promise.resolve(s(()=>null)),loading:null,ssr:!0},o=function(e){let t={...i,...e},n=(0,a.lazy)(()=>t.loader().then(s)),o=t.loading;function u(e){let s=o?(0,r.jsx)(o,{isLoading:!0,pastDelay:!0,error:null}):null,i=t.ssr?(0,r.jsx)(n,{...e}):(0,r.jsx)(l.BailoutToCSR,{reason:"next/dynamic",children:(0,r.jsx)(n,{...e})});return(0,r.jsx)(a.Suspense,{fallback:s,children:i})}return u.displayName="LoadableComponent",u}},5148:function(e,t,n){"use strict";n.d(t,{v:function(){return u}});var r=n(3827),a=n(4090),l=n(2920),s=n(4930),i=n.n(s);n(8820);let o=i()(()=>Promise.all([n.e(492),n.e(714),n.e(562)]).then(n.bind(n,6714)),{loadableGenerated:{webpack:()=>[6714]},ssr:!1});function u(e){let{initialData:t,onSubmit:n,platforms:s,onSuccess:i,onError:u}=e,[c,d]=(0,a.useState)(""),[f,m]=(0,a.useState)(""),[h,g]=(0,a.useState)(""),[x,p]=(0,a.useState)(null);(0,a.useEffect)(()=>{t?(d(t.title),m(t.content),g(t.platform_id||""),p(t.published_at?new Date(t.published_at):null)):(d(""),m(""),g(s.length>0?s[0].magazine_id:""),p(null))},[t,s]);let b=(0,a.useMemo)(()=>({spellChecker:!1,placeholder:"Write your article in Markdown..."}),[]),y=async e=>{e.preventDefault();let r=s.find(e=>e.magazine_id===h),a={title:c,content:f,platform_id:h,magazine_name:r?r.magazine_name:"",status:"draft"};x&&(a.published_at=x.toISOString());try{let e=await n(t?{...a,article_id:t.article_id}:a);return null==i||i(),t||(d(""),m(""),g(s.length>0?s[0].magazine_id:""),p(null)),e}catch(e){null==u||u(e instanceof Error?e.message:"Failed to save article")}};return(0,r.jsxs)("form",{onSubmit:y,className:"space-y-4 bg-white p-6 rounded-lg shadow-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Title"}),(0,r.jsx)("input",{id:"title",className:"p-2 block w-full rounded-md border-gray-300 shadow-sm focus:outline-none focus:border-teal-800 focus:ring-1 focus:ring-teal-800 mt-1",value:c,onChange:e=>d(e.target.value)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-700",children:"Content (Markdown supported)"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Use the toolbar to format your Markdown."}),(0,r.jsx)(o,{id:"content",value:f,onChange:m,options:b})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"platform",className:"block text-sm font-medium text-gray-700",children:"Platform"}),(0,r.jsx)("select",{id:"platform",className:"p-2 block w-full rounded-md border-gray-300 shadow-sm focus:outline-none focus:border-teal-800 focus:ring-1 focus:ring-teal-800 mt-1",value:h,onChange:e=>g(e.target.value),children:s.map(e=>(0,r.jsx)("option",{value:e.magazine_id,children:e.magazine_name},e.magazine_id))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"published_at",className:"block text-sm font-medium text-gray-700",children:"Published At"}),(0,r.jsx)("input",{type:"datetime-local",id:"published_at",className:"p-2 block w-full rounded-md border-gray-300 shadow-sm focus:outline-none focus:border-teal-800 focus:ring-1 focus:ring-teal-800 mt-1",value:x?(0,l.L9)(x):"",onChange:e=>p(e.target.value?new Date(e.target.value):null)})]}),(0,r.jsx)("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-teal-800 hover:bg-teal-800 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-800",children:t?"Update Article":"Create Article"})]})}},7372:function(e,t,n){"use strict";n.d(t,{A:function(){return c}});var r=n(3827),a=n(4292),l=n.n(a),s=n(4090),i=n(7907),o=n(3779),u=n(4958);function c(e){var t;let{children:n}=e,{user:a}=(0,s.useContext)(o.V),c=(0,i.useRouter)(),[d,f]=(0,s.useState)(!1),m=async()=>{await u.O.auth.signOut(),c.push("/login")},h=null==a?void 0:null===(t=a.user_metadata)||void 0===t?void 0:t.picture,g=!!h,x=a&&a.email?a.email.charAt(0).toUpperCase():"";return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)("nav",{className:"shadow-sm",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex h-16 items-center justify-between",children:[(0,r.jsx)("div",{className:"flex items-center space-x-4",children:(0,r.jsxs)("button",{onClick:()=>c.push("/"),className:"flex items-center space-x-2 focus:outline-none hover:opacity-80",children:[(0,r.jsx)("img",{src:"/sekai-message-logo.svg",alt:"Logo",className:"h-8 w-8 object-cover rounded-full"}),(0,r.jsx)("span",{className:"text-xl font-semibold ".concat(l().className),children:"SEKAI NI TODOKERU MESSAGES"})]})}),(0,r.jsxs)("div",{className:"flex items-center space-x-4 relative",children:[(0,r.jsx)("button",{onClick:()=>c.push("/sns"),className:"text-gray-700 hover:text-gray-900 focus:outline-none",children:"SNS"}),(0,r.jsx)("button",{onClick:()=>c.push("/articles"),className:"text-gray-700 hover:text-gray-900 focus:outline-none",children:"Articles"}),!a&&(0,r.jsx)("button",{onClick:()=>c.push("/login"),className:"text-gray-700 hover:text-gray-900 focus:outline-none",children:"Login"}),a&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>f(!d),className:"flex items-center justify-center w-10 h-10 rounded-full bg-gray-200 hover:bg-gray-300 relative focus:outline-none",children:g&&h?(0,r.jsx)("img",{src:h,alt:"User Avatar",className:"w-10 h-10 rounded-full object-cover"}):(0,r.jsx)("span",{className:"text-gray-700 font-bold",children:x})}),d&&(0,r.jsx)("div",{className:"absolute top-12 right-0 bg-white border rounded shadow-lg py-1 z-50 w-32",children:(0,r.jsx)("button",{onClick:m,className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 focus:outline-none",children:"Logout"})})]})]})]})})}),(0,r.jsx)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:n})]})}},3779:function(e,t,n){"use strict";n.d(t,{H:function(){return i},V:function(){return s}});var r=n(3827),a=n(4958),l=n(4090);let s=(0,l.createContext)({user:null});function i(e){let{children:t}=e,[n,i]=(0,l.useState)(null);return(0,l.useEffect)(()=>{a.O.auth.getUser().then(e=>{let{data:{user:t}}=e;return i(t)});let{data:e}=a.O.auth.onAuthStateChange((e,t)=>{var n;i(null!==(n=null==t?void 0:t.user)&&void 0!==n?n:null)});return()=>{e.subscription.unsubscribe()}},[]),(0,r.jsx)(s.Provider,{value:{user:n},children:t})}},6235:function(e,t,n){"use strict";n.d(t,{l:function(){return d}});var r=n(4090),a=n(1310),l=n(4958);async function s(e){let{data:t,error:n}=await l.O.from("articles").select("*").eq("author_id",e).order("published_at",{ascending:!1});if(n)throw n;return t}async function i(e,t){let{data:n,error:r}=await l.O.from("articles").insert({...e,author_id:t}).select().single();if(console.log(e),console.log(t),console.log(r),r)throw r;return n}async function o(e,t){let{data:n,error:r}=await l.O.from("articles").update({...e,author_id:t}).eq("article_id",e.article_id).eq("author_id",t).select().single();if(r)throw r;return n}async function u(e,t){let{error:n}=await l.O.from("articles").delete().eq("article_id",e).eq("author_id",t);if(n)throw n}var c=n(3779);function d(){let[e,t]=(0,r.useState)([]),[n,l]=(0,r.useState)(!0),{showToast:d}=(0,a.p)(),{user:f}=(0,r.useContext)(c.V);async function m(e){try{let n=await s(e);t(n)}catch(e){d(e instanceof Error?e.message:"Failed to load articles","error")}finally{l(!1)}}async function h(n){if(!f)throw d("Please log in to create articles","error"),Error("Not logged in");console.log(n);try{let r=await i({...n,user_id:f.id},f.id);return t([r,...e]),d("Article created successfully","success"),r}catch(e){throw d(e instanceof Error?e.message:"Failed to create article","error"),e}}async function g(n){if(!f)throw d("Please log in to update articles","error"),Error("Not logged in");try{let r=await o(n,f.id);return t(e.map(e=>e.article_id===r.article_id?r:e)),d("Article updated successfully","success"),r}catch(e){throw d(e instanceof Error?e.message:"Failed to update article","error"),e}}async function x(n){if(!f)throw d("Please log in to delete articles","error"),Error("Not logged in");try{await u(n,f.id),t(e.filter(e=>e.article_id!==n)),d("Article deleted successfully","success")}catch(e){throw d(e instanceof Error?e.message:"Failed to delete article","error"),e}}return(0,r.useEffect)(()=>{f?m(f.id):l(!1)},[f]),{articles:e,loading:n,createArticle:h,updateArticle:g,deleteArticle:x}}},4710:function(e,t,n){"use strict";n.d(t,{N:function(){return l}});var r=n(4090),a=n(4958);function l(){let[e,t]=(0,r.useState)([]);return(0,r.useEffect)(()=>{(async function(){let{data:e,error:n}=await a.O.from("magazine_master").select("*");n?console.error("Failed to fetch magazine list:",n.message):e&&t(e)})()},[]),{magazines:e}}},1310:function(e,t,n){"use strict";n.d(t,{p:function(){return a}});var r=n(4090);function a(){let[e,t]=(0,r.useState)({message:"",type:"success",isVisible:!1});return{toast:e,showToast:(0,r.useCallback)((e,n)=>{t({message:e,type:n,isVisible:!0})},[]),hideToast:(0,r.useCallback)(()=>{t(e=>({...e,isVisible:!1}))},[])}}},4958:function(e,t,n){"use strict";n.d(t,{O:function(){return s}});var r=n(9377);let a="https://lqncxiyjgzdpuatbzaoh.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxxbmN4aXlqZ3pkcHVhdGJ6YW9oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ1OTMwMjQsImV4cCI6MjA1MDE2OTAyNH0.6MzhRLgwmDECc63nzV0BUeMqySq2OvwE4B7jCTKEr5Q";if(!a||!l)throw Error("Missing Supabase environment variables");let s=(0,r.eI)(a,l)},2920:function(e,t,n){"use strict";function r(e){return e.toISOString().slice(0,16)}function a(e,t,n){if(!t&&!n)return!0;let r=new Date(e);if(r.setHours(0,0,0,0),t&&n){let e=new Date(t),a=new Date(n);return a.setHours(23,59,59,999),r>=e&&r<=a}if(t)return r>=new Date(t);if(n){let e=new Date(n);return e.setHours(23,59,59,999),r<=e}return!0}function l(e){let t=new Date;t.setHours(0,0,0,0);let n=new Date(e);return n.setHours(0,0,0,0),n>=t}n.d(t,{L9:function(){return r},Ux:function(){return l},XE:function(){return a}})},8820:function(){},4292:function(e){e.exports={style:{fontFamily:"'__Kalam_dd6f7c', '__Kalam_Fallback_dd6f7c'",fontWeight:700,fontStyle:"normal"},className:"__className_dd6f7c"}}}]);