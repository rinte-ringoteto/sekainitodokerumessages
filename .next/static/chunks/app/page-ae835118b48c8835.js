(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5507:function(e,t,s){Promise.resolve().then(s.bind(s,8836))},8836:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return x}});var a=s(3827),n=s(4090),l=s(7372),r=s(3779),i=s(4958),c=s(333);s(9865);var o=s(7907),d=s(4059),u=s(4562);function x(){let{user:e}=(0,n.useContext)(r.V),[t,s]=(0,n.useState)([]),[i,x]=(0,n.useState)(!0),p=(0,o.useRouter)(),g=new Date,[f,b]=(0,n.useState)(new Date(g.getFullYear(),g.getMonth(),g.getDate()));(0,n.useEffect)(()=>{if(!e){x(!1);return}!async function(){x(!0);let t=new Date(g.getFullYear(),g.getMonth(),g.getDate()),a=await m(e.id),n=await h(e.id),l=a.map(e=>({...e,post_date:new Date(e.post_date)})),r=n.map(e=>({...e,published_at:new Date(e.published_at)}));s([...l.filter(e=>new Date(e.post_date.getFullYear(),e.post_date.getMonth(),e.post_date.getDate()).getTime()>=t.getTime()).map(e=>({type:"post",id:e.post_id,name:e.sns_name,status:e.status,date:e.post_date})),...r.filter(e=>new Date(e.published_at.getFullYear(),e.published_at.getMonth(),e.published_at.getDate()).getTime()>=t.getTime()).map(e=>({type:"article",id:e.article_id,name:e.magazine_name,status:e.status,date:e.published_at}))].sort((e,t)=>e.date.getTime()-t.date.getTime())),x(!1)}()},[e]);let y=new Map;t.forEach(e=>{let t=new Date(e.date.getFullYear(),e.date.getMonth(),e.date.getDate()).toISOString().split("T")[0];y.has(t)||y.set(t,[]),y.get(t).push(e)});let j=f.toISOString().split("T")[0],N=t.filter(e=>new Date(e.date.getFullYear(),e.date.getMonth(),e.date.getDate()).toISOString().split("T")[0]===j);return(0,a.jsx)(l.A,{children:(0,a.jsxs)("div",{className:"flex gap-8",children:[(0,a.jsxs)("div",{className:"w-1/2 bg-white p-4 rounded shadow-sm",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Calendar"}),(0,a.jsx)(c.ZP,{locale:"en-US",tileContent:e=>{let{date:t,view:s}=e;if("month"===s){let e=t.toISOString().split("T")[0],s=y.get(e);if(s&&s.length>0)return(0,a.jsx)("div",{className:"flex space-x-1 mt-1",children:s.map((e,t)=>{let s="post"===e.type?"text-red-500":"text-blue-500";return(0,a.jsx)("span",{className:"".concat(s," text-xs"),children:"●"},t)})})}return null},onChange:e=>{let t=Array.isArray(e)?e[0]:e;b(new Date(t.getFullYear(),t.getMonth(),t.getDate()))},value:f,className:"my-calendar mx-auto border-none shadow-md rounded-lg p-2 text-sm"})]}),(0,a.jsxs)("div",{className:"w-1/2 bg-white p-4 rounded shadow-sm",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:i?"Loading...":"Posts/Articles on ".concat(f.toLocaleDateString("en-US"))}),i?(0,a.jsx)("div",{children:"Loading..."}):0===N.length?(0,a.jsxs)("div",{children:["No posts or articles on this day.",(0,a.jsxs)("div",{className:"mt-4 flex space-x-2",children:[(0,a.jsxs)("button",{onClick:()=>p.push("/sns"),className:"px-4 py-2 bg-teal-800 text-white rounded hover:bg-teal-900 focus:outline-none flex items-center",children:[(0,a.jsx)(d.Z,{className:"w-4 h-4 mr-2"}),"SNS"]}),(0,a.jsxs)("button",{onClick:()=>p.push("/articles"),className:"px-4 py-2 bg-teal-800 text-white rounded hover:bg-teal-900 focus:outline-none flex items-center",children:[(0,a.jsx)(u.Z,{className:"w-4 h-4 mr-2"}),"Articles"]})]})]}):(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 table-fixed",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map(e=>{let t="draft"===e.status?"bg-gray-100 text-gray-800":"bg-green-100 text-green-800";return(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-2 text-sm text-gray-700",children:"post"===e.type?"SNS Post":"Article"}),(0,a.jsx)("td",{className:"px-4 py-2 text-sm text-gray-700",children:(0,a.jsx)("div",{className:"flex items-center space-x-2",children:e.name&&(0,a.jsx)("img",{src:"https://lqncxiyjgzdpuatbzaoh.supabase.co/storage/v1/object/public/sns-icons/".concat(e.name,".png"),alt:e.name,className:"h-5 w-5"})})}),(0,a.jsx)("td",{className:"px-4 py-2 text-sm text-gray-700",children:(0,a.jsx)("span",{className:"inline-block w-20 text-center px-2 py-1 rounded text-xs font-semibold ".concat(t),children:e.status})}),(0,a.jsx)("td",{className:"px-4 py-2 text-sm text-gray-700",children:e.date.toLocaleDateString("en-US")})]},e.type+"_"+e.id)})})]})]})]})})}async function m(e){let{data:t,error:s}=await i.O.from("posts").select("*").eq("user_id",e);return s?(console.error("Failed to fetch posts:",s.message),[]):null!=t?t:[]}async function h(e){let{data:t,error:s}=await i.O.from("articles").select("*").eq("user_id",e);return s?(console.error("Failed to fetch articles:",s.message),[]):null!=t?t:[]}},7372:function(e,t,s){"use strict";s.d(t,{A:function(){return d}});var a=s(3827),n=s(4292),l=s.n(n),r=s(4090),i=s(7907),c=s(3779),o=s(4958);function d(e){var t;let{children:s}=e,{user:n}=(0,r.useContext)(c.V),d=(0,i.useRouter)(),[u,x]=(0,r.useState)(!1),m=async()=>{await o.O.auth.signOut(),d.push("/login")},h=null==n?void 0:null===(t=n.user_metadata)||void 0===t?void 0:t.picture,p=!!h,g=n&&n.email?n.email.charAt(0).toUpperCase():"";return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("nav",{className:"shadow-sm",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex h-16 items-center justify-between",children:[(0,a.jsx)("div",{className:"flex items-center space-x-4",children:(0,a.jsxs)("button",{onClick:()=>d.push("/"),className:"flex items-center space-x-2 focus:outline-none hover:opacity-80",children:[(0,a.jsx)("img",{src:"/sekai-message-logo.svg",alt:"Logo",className:"h-8 w-8 object-cover rounded-full"}),(0,a.jsx)("span",{className:"text-xl font-semibold ".concat(l().className),children:"SEKAI NI TODOKERU MESSAGES"})]})}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 relative",children:[(0,a.jsx)("button",{onClick:()=>d.push("/sns"),className:"text-gray-700 hover:text-gray-900 focus:outline-none",children:"SNS"}),(0,a.jsx)("button",{onClick:()=>d.push("/articles"),className:"text-gray-700 hover:text-gray-900 focus:outline-none",children:"Articles"}),!n&&(0,a.jsx)("button",{onClick:()=>d.push("/login"),className:"text-gray-700 hover:text-gray-900 focus:outline-none",children:"Login"}),n&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>x(!u),className:"flex items-center justify-center w-10 h-10 rounded-full bg-gray-200 hover:bg-gray-300 relative focus:outline-none",children:p&&h?(0,a.jsx)("img",{src:h,alt:"User Avatar",className:"w-10 h-10 rounded-full object-cover"}):(0,a.jsx)("span",{className:"text-gray-700 font-bold",children:g})}),u&&(0,a.jsx)("div",{className:"absolute top-12 right-0 bg-white border rounded shadow-lg py-1 z-50 w-32",children:(0,a.jsx)("button",{onClick:m,className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 focus:outline-none",children:"Logout"})})]})]})]})})}),(0,a.jsx)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:s})]})}},3779:function(e,t,s){"use strict";s.d(t,{H:function(){return i},V:function(){return r}});var a=s(3827),n=s(4958),l=s(4090);let r=(0,l.createContext)({user:null});function i(e){let{children:t}=e,[s,i]=(0,l.useState)(null);return(0,l.useEffect)(()=>{n.O.auth.getUser().then(e=>{let{data:{user:t}}=e;return i(t)});let{data:e}=n.O.auth.onAuthStateChange((e,t)=>{var s;i(null!==(s=null==t?void 0:t.user)&&void 0!==s?s:null)});return()=>{e.subscription.unsubscribe()}},[]),(0,a.jsx)(r.Provider,{value:{user:s},children:t})}},4958:function(e,t,s){"use strict";s.d(t,{O:function(){return r}});var a=s(9377);let n="https://lqncxiyjgzdpuatbzaoh.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxxbmN4aXlqZ3pkcHVhdGJ6YW9oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ1OTMwMjQsImV4cCI6MjA1MDE2OTAyNH0.6MzhRLgwmDECc63nzV0BUeMqySq2OvwE4B7jCTKEr5Q";if(!n||!l)throw Error("Missing Supabase environment variables");let r=(0,a.eI)(n,l)}},function(e){e.O(0,[377,259,971,69,744],function(){return e(e.s=5507)}),_N_E=e.O()}]);