(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[222],{8719:function(e,t,a){Promise.resolve().then(a.bind(a,1205))},7461:function(e,t,a){"use strict";a.d(t,{Z:function(){return i}});var s=a(4090),r={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),i=(e,t)=>{let a=(0,s.forwardRef)((a,i)=>{let{color:l="currentColor",size:c=24,strokeWidth:o=2,absoluteStrokeWidth:u,className:d="",children:m,...h}=a;return(0,s.createElement)("svg",{ref:i,...r,width:c,height:c,stroke:l,strokeWidth:u?24*Number(o)/Number(c):o,className:["lucide","lucide-".concat(n(e)),d].join(" "),...h},[...t.map(e=>{let[t,a]=e;return(0,s.createElement)(t,a)}),...Array.isArray(m)?m:[m]])});return a.displayName="".concat(e),a}},9355:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(7461).Z)("CalendarClock",[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.3V14",key:"akvzfd"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]])},7307:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(7461).Z)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},6490:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(7461).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},489:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(7461).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},7907:function(e,t,a){"use strict";var s=a(5313);a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}})},1205:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return y}});var s=a(3827),r=a(4090),n=a(7372),i=a(489);function l(e){let{article:t,onSelect:a,onDelete:r,onUpdate:n}=e,l=async e=>{e.stopPropagation(),await r(t.article_id)},c=t.content.length>15?t.content.substring(0,15)+"...":t.content,o="draft"===t.status?"bg-gray-100 text-gray-800":"bg-green-100 text-green-800",u=async e=>{e.stopPropagation();let a="draft"===t.status?"published":"draft";await n({...t,status:a})};return(0,s.jsxs)("tr",{className:"cursor-pointer hover:bg-gray-50",onClick:()=>a(t.article_id),children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap w-12",children:(0,s.jsx)("div",{className:"flex items-center space-x-2",children:t.magazine_name&&(0,s.jsx)("img",{src:"https://lqncxiyjgzdpuatbzaoh.supabase.co/storage/v1/object/public/sns-icons/".concat(t.magazine_name,".png"),alt:t.magazine_name,className:"h-5 w-5"})})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:t.title}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:c}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap cursor-pointer",onClick:u,children:(0,s.jsx)("span",{className:"inline-block w-20 text-center px-2 py-1 rounded text-xs font-semibold ".concat(o),children:t.status})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:t.published_at?new Date(t.published_at).toLocaleDateString():"-"}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("button",{onClick:l,className:"text-red-600 hover:text-red-800 flex justify-center items-center",children:(0,s.jsx)(i.Z,{className:"h-5 w-5"})})})]})}function c(e){let{articles:t,onSelect:a,onDelete:r,onUpdate:n}=e;return(0,s.jsx)("div",{className:"bg-white shadow-sm rounded-lg overflow-hidden",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 table-auto",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Magazine"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Title"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Content"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Published At"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(e=>(0,s.jsx)(l,{article:e,onSelect:a,onDelete:r,onUpdate:n},e.article_id))})]})})})}var o=a(6235),u=a(7907),d=a(5757);function m(e){let{magazines:t,selectedPlatform:a,onPlatformChange:r}=e;return(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("button",{onClick:()=>r(""),className:"px-3 py-1 rounded-full text-sm ".concat(""===a?"bg-teal-100 text-teal-800":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"All"}),null==t?void 0:t.map(e=>(0,s.jsx)("button",{onClick:()=>r(e.magazine_id),className:"px-3 py-1 rounded-full text-sm ".concat(a===e.magazine_id?"bg-teal-100 text-teal-800":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e.magazine_name},e.magazine_id))]})}function h(e){let{platforms:t,selectedPlatform:a,startDate:r,endDate:n,onPlatformChange:i,onStartDateChange:l,onEndDateChange:c}=e;return(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm mb-6 space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Magazine"}),(0,s.jsx)(m,{magazines:t,selectedPlatform:a,onPlatformChange:i})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Date Range"}),(0,s.jsx)(d.f,{startDate:r,endDate:n,onStartDateChange:l,onEndDateChange:c})]})]})}var x=a(9355),p=a(6490);function g(e){let{activeTab:t,onTabChange:a,upcomingCount:r,pastCount:n}=e;return(0,s.jsx)("div",{className:"border-b border-gray-200",children:(0,s.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[(0,s.jsxs)("button",{onClick:()=>a("upcoming"),className:"\n            flex items-center gap-2 py-4 px-1 border-b-2 text-sm font-medium\n            ".concat("upcoming"===t?"border-teal-800 text-teal-800":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","\n          "),children:[(0,s.jsx)(x.Z,{className:"h-4 w-4"}),"Upcoming",(0,s.jsx)("span",{className:"ml-2 rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-600",children:r})]}),(0,s.jsxs)("button",{onClick:()=>a("past"),className:"\n            flex items-center gap-2 py-4 px-1 border-b-2 text-sm font-medium\n            ".concat("past"===t?"border-teal-800 text-teal-800":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","\n          "),children:[(0,s.jsx)(p.Z,{className:"h-4 w-4"}),"Past",(0,s.jsx)("span",{className:"ml-2 rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-600",children:n})]})]})})}var f=a(4710);function y(){let{articles:e,loading:t,deleteArticle:a,updateArticle:i}=(0,o.l)(),[l,d]=(0,r.useState)(),m=(0,u.useRouter)(),{magazines:x}=(0,f.N)(),{selectedPlatform:p,setSelectedPlatform:y,startDate:b,setStartDate:w,endDate:v,setEndDate:j,filteredArticles:N}=function(e){let[t,a]=(0,r.useState)(""),[s,n]=(0,r.useState)(""),[i,l]=(0,r.useState)(""),c=(0,r.useMemo)(()=>{let a=e;return t&&(a=a.filter(e=>e.platform_id===t)),s&&(a=a.filter(e=>e.published_at&&new Date(e.published_at)>=new Date(s))),i&&(a=a.filter(e=>e.published_at&&new Date(e.published_at)<=new Date(i))),a},[e,t,s,i]);return{selectedPlatform:t,setSelectedPlatform:a,startDate:s,setStartDate:n,endDate:i,setEndDate:l,filteredArticles:c}}(e),{activeTab:k,setActiveTab:_,currentArticles:C,upcomingCount:D,pastCount:S}=function(e){let[t,a]=(0,r.useState)("upcoming"),s=new Date,n=new Date(s.getFullYear(),s.getMonth(),s.getDate()),{upcomingArticles:i,pastArticles:l}=(0,r.useMemo)(()=>{let t=[],a=[];return e.forEach(e=>{if(!e.published_at){a.push(e);return}let s=new Date(e.published_at);new Date(s.getFullYear(),s.getMonth(),s.getDate()).getTime()>=n.getTime()?t.push(e):a.push(e)}),t.sort((e,t)=>{let a=new Date(e.published_at),s=new Date(t.published_at);return a.getTime()-s.getTime()}),a.sort((e,t)=>{let a=new Date(e.published_at);return new Date(t.published_at).getTime()-a.getTime()}),{upcomingArticles:t,pastArticles:a}},[e,n]);return{activeTab:t,setActiveTab:a,currentArticles:"upcoming"===t?i:l,upcomingCount:i.length,pastCount:l.length}}(N);if(t)return(0,s.jsx)(n.A,{children:(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})})});let E=async e=>{await a(e),(null==l?void 0:l.article_id)===e&&d(void 0)},M=async e=>await i(e);return(0,s.jsx)(n.A,{children:(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsx)(h,{platforms:x,selectedPlatform:p,startDate:b,endDate:v,onPlatformChange:y,onStartDateChange:w,onEndDateChange:j}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold",children:"Articles"}),(0,s.jsx)("button",{onClick:()=>m.push("/articles/new"),className:"px-4 py-2 text-sm font-medium text-white bg-teal-800 hover:bg-teal-900 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-900",children:"New Article"})]}),(0,s.jsx)(g,{activeTab:k,onTabChange:_,upcomingCount:D,pastCount:S}),(0,s.jsx)(c,{articles:C,onSelect:e=>{m.push("/articles/".concat(e))},onDelete:E,onUpdate:M})]})})}},5757:function(e,t,a){"use strict";a.d(t,{f:function(){return n}});var s=a(3827);a(4090);var r=a(7307);function n(e){let{startDate:t,endDate:a,onStartDateChange:n,onEndDateChange:i}=e;return(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(r.Z,{className:"h-4 w-4 text-gray-500 mr-2"}),(0,s.jsx)("input",{type:"date",value:t,onChange:e=>n(e.target.value),className:"rounded-md border-gray-300 shadow-sm focus:outline-none focus:ring-1 focus:border-blue-500 focus:ring-blue-500"})]}),(0,s.jsx)("span",{className:"text-gray-500",children:"to"}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(r.Z,{className:"h-4 w-4 text-gray-500 mr-2"}),(0,s.jsx)("input",{type:"date",value:a,onChange:e=>i(e.target.value),className:"rounded-md border-gray-300 shadow-sm focus:outline-none focus:ring-1 focus:border-blue-500 focus:ring-blue-500"})]})]})}},7372:function(e,t,a){"use strict";a.d(t,{A:function(){return u}});var s=a(3827),r=a(4292),n=a.n(r),i=a(4090),l=a(7907),c=a(3779),o=a(4958);function u(e){var t;let{children:a}=e,{user:r}=(0,i.useContext)(c.V),u=(0,l.useRouter)(),[d,m]=(0,i.useState)(!1),h=async()=>{await o.O.auth.signOut(),u.push("/login")},x=null==r?void 0:null===(t=r.user_metadata)||void 0===t?void 0:t.picture,p=!!x,g=r&&r.email?r.email.charAt(0).toUpperCase():"";return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("nav",{className:"shadow-sm",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex h-16 items-center justify-between",children:[(0,s.jsx)("div",{className:"flex items-center space-x-4",children:(0,s.jsxs)("button",{onClick:()=>u.push("/"),className:"flex items-center space-x-2 focus:outline-none hover:opacity-80",children:[(0,s.jsx)("img",{src:"/sekai-message-logo.svg",alt:"Logo",className:"h-8 w-8 object-cover rounded-full"}),(0,s.jsx)("span",{className:"text-xl font-semibold ".concat(n().className),children:"SEKAI NI TODOKERU MESSAGES"})]})}),(0,s.jsxs)("div",{className:"flex items-center space-x-4 relative",children:[(0,s.jsx)("button",{onClick:()=>u.push("/sns"),className:"text-gray-700 hover:text-gray-900 focus:outline-none",children:"SNS"}),(0,s.jsx)("button",{onClick:()=>u.push("/articles"),className:"text-gray-700 hover:text-gray-900 focus:outline-none",children:"Articles"}),!r&&(0,s.jsx)("button",{onClick:()=>u.push("/login"),className:"text-gray-700 hover:text-gray-900 focus:outline-none",children:"Login"}),r&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>m(!d),className:"flex items-center justify-center w-10 h-10 rounded-full bg-gray-200 hover:bg-gray-300 relative focus:outline-none",children:p&&x?(0,s.jsx)("img",{src:x,alt:"User Avatar",className:"w-10 h-10 rounded-full object-cover"}):(0,s.jsx)("span",{className:"text-gray-700 font-bold",children:g})}),d&&(0,s.jsx)("div",{className:"absolute top-12 right-0 bg-white border rounded shadow-lg py-1 z-50 w-32",children:(0,s.jsx)("button",{onClick:h,className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 focus:outline-none",children:"Logout"})})]})]})]})})}),(0,s.jsx)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:a})]})}},3779:function(e,t,a){"use strict";a.d(t,{H:function(){return l},V:function(){return i}});var s=a(3827),r=a(4958),n=a(4090);let i=(0,n.createContext)({user:null});function l(e){let{children:t}=e,[a,l]=(0,n.useState)(null);return(0,n.useEffect)(()=>{r.O.auth.getUser().then(e=>{let{data:{user:t}}=e;return l(t)});let{data:e}=r.O.auth.onAuthStateChange((e,t)=>{var a;l(null!==(a=null==t?void 0:t.user)&&void 0!==a?a:null)});return()=>{e.subscription.unsubscribe()}},[]),(0,s.jsx)(i.Provider,{value:{user:a},children:t})}},6235:function(e,t,a){"use strict";a.d(t,{l:function(){return d}});var s=a(4090),r=a(1310),n=a(4958);async function i(e){let{data:t,error:a}=await n.O.from("articles").select("*").eq("author_id",e).order("published_at",{ascending:!1});if(a)throw a;return t}async function l(e,t){let{data:a,error:s}=await n.O.from("articles").insert({...e,author_id:t}).select().single();if(console.log(e),console.log(t),console.log(s),s)throw s;return a}async function c(e,t){let{data:a,error:s}=await n.O.from("articles").update({...e,author_id:t}).eq("article_id",e.article_id).eq("author_id",t).select().single();if(s)throw s;return a}async function o(e,t){let{error:a}=await n.O.from("articles").delete().eq("article_id",e).eq("author_id",t);if(a)throw a}var u=a(3779);function d(){let[e,t]=(0,s.useState)([]),[a,n]=(0,s.useState)(!0),{showToast:d}=(0,r.p)(),{user:m}=(0,s.useContext)(u.V);async function h(e){try{let a=await i(e);t(a)}catch(e){d(e instanceof Error?e.message:"Failed to load articles","error")}finally{n(!1)}}async function x(a){if(!m)throw d("Please log in to create articles","error"),Error("Not logged in");console.log(a);try{let s=await l({...a,user_id:m.id},m.id);return t([s,...e]),d("Article created successfully","success"),s}catch(e){throw d(e instanceof Error?e.message:"Failed to create article","error"),e}}async function p(a){if(!m)throw d("Please log in to update articles","error"),Error("Not logged in");try{let s=await c(a,m.id);return t(e.map(e=>e.article_id===s.article_id?s:e)),d("Article updated successfully","success"),s}catch(e){throw d(e instanceof Error?e.message:"Failed to update article","error"),e}}async function g(a){if(!m)throw d("Please log in to delete articles","error"),Error("Not logged in");try{await o(a,m.id),t(e.filter(e=>e.article_id!==a)),d("Article deleted successfully","success")}catch(e){throw d(e instanceof Error?e.message:"Failed to delete article","error"),e}}return(0,s.useEffect)(()=>{m?h(m.id):n(!1)},[m]),{articles:e,loading:a,createArticle:x,updateArticle:p,deleteArticle:g}}},4710:function(e,t,a){"use strict";a.d(t,{N:function(){return n}});var s=a(4090),r=a(4958);function n(){let[e,t]=(0,s.useState)([]);return(0,s.useEffect)(()=>{(async function(){let{data:e,error:a}=await r.O.from("magazine_master").select("*");a?console.error("Failed to fetch magazine list:",a.message):e&&t(e)})()},[]),{magazines:e}}},1310:function(e,t,a){"use strict";a.d(t,{p:function(){return r}});var s=a(4090);function r(){let[e,t]=(0,s.useState)({message:"",type:"success",isVisible:!1});return{toast:e,showToast:(0,s.useCallback)((e,a)=>{t({message:e,type:a,isVisible:!0})},[]),hideToast:(0,s.useCallback)(()=>{t(e=>({...e,isVisible:!1}))},[])}}},4958:function(e,t,a){"use strict";a.d(t,{O:function(){return i}});var s=a(9377);let r="https://lqncxiyjgzdpuatbzaoh.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxxbmN4aXlqZ3pkcHVhdGJ6YW9oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ1OTMwMjQsImV4cCI6MjA1MDE2OTAyNH0.6MzhRLgwmDECc63nzV0BUeMqySq2OvwE4B7jCTKEr5Q";if(!r||!n)throw Error("Missing Supabase environment variables");let i=(0,s.eI)(r,n)},4292:function(e){e.exports={style:{fontFamily:"'__Kalam_dd6f7c', '__Kalam_Fallback_dd6f7c'",fontWeight:700,fontStyle:"normal"},className:"__className_dd6f7c"}}},function(e){e.O(0,[377,971,69,744],function(){return e(e.s=8719)}),_N_E=e.O()}]);